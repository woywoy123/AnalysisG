name: Building AnalysisG
on:
  pull_request:
      branches:
        - "master"

      paths-ignore:
        - '**.md'
        - 'docs'
        - 'scripts'

  push:
      branches:
        - "master"

      paths-ignore:
        - '**.md'
        - 'docs'
        - 'scripts'

defaults:
  run:
    shell: bash
  
jobs:
    build:
        name: "Python ${{ matrix.python-version }} on ${{ matrix.os }}"
        runs-on: "${{ matrix.os }}"
        strategy: 
                fail-fast: false
                matrix:
                    os:
                      #- ubuntu-20.04
                      #- ubuntu-22.04
                        - ubuntu-latest

                    python-version:
                      #  - "3.9"
                      #  - "3.10"
                      #  - "3.11"
                        - "3.12"

        steps:      
            - name: "Checkout the repo"
              uses: "actions/checkout@v3"

            - name: "Configuring Python - ${{ matrix.python-version }}"
              uses: "actions/setup-python@v4"
              with: 
                python-version: "${{ matrix.python-version }}"
            
            - name: "Building ROOT from source"
              run: |
                sudo apt update
                sudo apt-get install -y nvidia-cuda-toolkit
                sudo apt-get install -y rapidjson-dev libhdf5-dev
                sudo apt-get install -y cmake dpkg-dev g++ gcc libssl-dev

                wget https://root.cern/download/root_v6.32.02.Linux-almalinux9.4-x86_64-gcc11.4.tar.gz
                tar -xzvf root_v6.32.02.Linux-almalinux9.4-x86_64-gcc11.4.tar.gz
                source root/bin/thisroot.sh

                export TORCH_CUDA_ARCH_LIST="8.0 8.6 8.9 9.0"
                pip install -v .
