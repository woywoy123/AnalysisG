name: Building AnalysisG
on:
  pull_request:
      branches:
        - "master"

      paths-ignore:
        - '**.md'
        - 'docs'
        - 'scripts'

  push:
      branches:
        - "master"

      paths-ignore:
        - '**.md'
        - 'docs'
        - 'scripts'

defaults:
  run:
    shell: bash
  
jobs:
    build:
        name: "Python ${{ matrix.python-version }} on ${{ matrix.os }}"
        runs-on: "${{ matrix.os }}"
        strategy: 
                fail-fast: false
                matrix:
                    os:
                      #- ubuntu-20.04
                      #- ubuntu-22.04
                        - ubuntu-latest

                    python-version:
                      #  - "3.9"
                      #  - "3.10"
                      #  - "3.11"
                        - "3.12"

        steps:      
            - name: "Checkout the repo"
              uses: "actions/checkout@v3"

            - name: "Configuring Python - ${{ matrix.python-version }}"
              uses: "actions/setup-python@v4"
              with: 
                python-version: "${{ matrix.python-version }}"
            
            - name: "Building ROOT from source"
              run: |
                sudo apt update
                sudo apt install -y libhdf5-dev
                sudo apt install -y rapidjson-dev
                sudo apt-get install -y binutils cmake dpkg-dev g++ gcc libssl-dev git libx11-dev
                sudo apt-get install -y libxext-dev libxft-dev libxpm-dev libtbb-dev
                sudo apt-get install -y gfortran libpcre3-dev libglu1-mesa-dev libglew-dev 
                sudo apt-get install -y libftgl-dev libfftw3-dev libcfitsio-dev libgraphviz-dev 
                sudo apt-get install -y libavahi-compat-libdnssd-dev libldap2-dev 
                sudo apt-get install -y python3-dev python3-numpy libxml2-dev libkrb5-dev 
                sudo apt-get install -y libgsl-dev qtwebengine5-dev nlohmann-json3-dev libmysqlclient-dev
                
                git clone --branch latest-stable --depth=1 https://github.com/root-project/root.git root_src
                mkdir build install
                cd build 

                cmake -Dxrootd=OFF -Dbuiltin_xrootd=OFF -Dclad=OFF -DCMAKE_INSTALL_PREFIX=../install ../root_src
                cmake --build . --target install -j12
                source ../install/bin/thisroot.sh
                cd ..

            - name: "building AnalysisG"
              run: |
                python -m pip install pipx
                python -m pipx run build --sdist
